<!-- @format -->

<html>
	<script type="text/javascript">
		let canvasClasses = new Map();

		class CanvasClass {
			canvas;
			canvasId;
			ctx;
			prevX;
			currX;
			prevY;
			currY;
			bDrawOnMove = false;
			BRectLeft;
			BRectTop;
			scaleMode = 2;
			pathsarray = [];
			points = [];
			newLine = true;
            lastDraw = { x: -1, y: -1 };
			constructor(canvasId) {
				this.canvasId = canvasId;
				this.canvas = document.getElementById(canvasId);
				this.ctx = this.canvas.getContext('2d');
                this.GetCanvasBoundingRect();
				this.canvas.width = window.innerWidth;
				this.canvas.height = window.innerHeight;
				this.canvas.addEventListener(
					'mousemove',
					(e) => {
						this.move(e);
					},
					false
				);
				this.canvas.addEventListener(
					'mousedown',
					(e) => {
						this.onMouseDown(e);
					},
					false
				);
				this.canvas.addEventListener(
					'mouseup',
					(e) => {
						this.bDrawOnMove = false;
					},
					false
				);
               
				
			}
			onCanvasSizeChange() {
               
				this.windowResize;
			}
			move(e) {
				if (this.bDrawOnMove) {
					this.prevX = this.currX;
					this.prevY = this.currY;
					this.currX = e.clientX - this.canvas.offsetLeft;
					this.currY = e.clientY - this.canvas.offsetTop;
					this.draw();
				}
			}
			onMouseDown(e) {
				if (this.bDrawOnMove === true) {
				}
                else{
                    if(this.newLine === true)
                    {
                        this.newLine = false;
                        this.prevX = e.clientX;
                        this.prevY = e.clientY;
                        return;
                    }
                    this.draw(e.clientX, e.clientY);
                }
			}
			windowResize() {
				this.canvas.width = window.innerWidth;
				this.canvas.height = window.innerHeight;
				this.GetCanvasBoundingRect();
				/* erase(false);*/
				//this.scaleToFit(img);
			}
			GetCanvasBoundingRect() {
				this.BRectLeft = document
					.getElementById(this.canvasId)
					.getBoundingClientRect().left;
				this.BRectTop = document
					.getElementById(this.canvasId)
					.getBoundingClientRect().top;
			}
			draw(currX, currY) {
				//this.windowResize();
				var scaleX, scaleY, rect;
				rect = document.getElementById(this.canvasId).getBoundingClientRect();

				scaleX = this.canvas.width / rect.width;
				scaleY = this.canvas.height / rect.height;
                this.ctx.beginPath();
				
				this.ctx.moveTo((this.prevX - this.BRectLeft) * scaleX, (this.prevY - this.BRectTop) * scaleY);
				this.ctx.lineTo((currX - this.BRectLeft) * scaleX, (currY - this.BRectTop) * scaleY);
				//ctx.moveTo(prevX - BRectLeft, prevY - BRectTop);
				//ctx.lineTo(currX - BRectLeft, currY - BRectTop);
                this.ctx.strokeStyle = 'red';
				this.ctx.lineWidth = 2;
				this.ctx.stroke();
				this.ctx.closePath();
				this.lastDraw.x = currX;
				this.lastDraw.y = currY;
				this.points = [];
				this.points.push({ x: this.prevX, y: this.prevY });
				this.points.push({ x: this.currX, y: this.currY });
                
				this.pathsarray.push(this.points);
                this.prevX = currX;
                this.prevY = currY;
				return '';
			}
			/* draw() {
				if (this.bDrawOnMove) {
					this.ctx.beginPath();
					this.ctx.moveTo(prevX, prevY);
					this.ctx.lineTo(currX, currY);
					this.ctx.strokeStyle = x;
					this.ctx.lineWidth = y;
					this.ctx.stroke();
					this.ctx.closePath();
				}
			} */

			drawPath() {
				erase(false);
				var dpoint;
				this.ctx.beginPath();
				pathsarray.forEach((path) => {
					dpoint = GetDrawingPoint(path[0]);
					this.ctx.moveTo(dpoint.x, dpoint.y);
					for (let i = 1; i < path.length; i++) {
						dpoint = GetDrawingPoint(path[i]);
						this.ctx.lineTo(dpoint.x, dpoint.y);
					}
					this.ctx.stroke();
				});
				this.ctx.closePath();
			}

			clearCanvas() {
				this.ctx.clearRect(0, 0, w, h);
				scaleToFit(img);
			}
			scaleToFit(img) {
				// get the scale
				if (this.scaleMode == 0) {
					this.ctx.drawImage(img, 0, 0);
				} else if (this.scaleMode == 1) {
					var scaleWidth = this.canvas.width / this.img.width;
					this.ctx.drawImage(
						this.img,
						0,
						0,
						this.img.width * scaleWidth,
						this.img.height * scaleWidth
					);
				} else if ((this.scaleMode = 2)) {
					var scaleWidth = this.canvas.width / this.img.width;
					var scaleHeight = this.canvas.height / this.img.height;
					this.ctx.drawImage(
						this.img,
						0,
						0,
						this.img.width * scaleWidth,
						this.img.height * scaleHeight
					);
				} else {
					var scale = Math.min(
						this.canvas.width / this.img.width,
						this.canvas.height / this.img.height
					);
					// get the top left position of the image
					var x = this.canvas.width / 2 - (this.img.width / 2) * scale;
					var y = this.canvas.height / 2 - (this.img.height / 2) * scale;
					this.ctx.drawImage(this.img, x, y, this.img.width * scale, this.img.height * scale);
				}
			}
		}

		var canvas,
			ctx,
			flag = false,
			prevX = 0,
			currX = 0,
			prevY = 0,
			currY = 0,
			dot_flag = false;
		first = true;
		var x = 'black',
			y = 2;
		var cmap;
		function init() {
			c1 = new CanvasClass('can', canvas);
			canvasClasses.set('can', c1);
			c2 = new CanvasClass('can2');
			canvasClasses.set('can2', c2);
			cmap = canvasClasses.get('can');
			// cmap.canvas.addEventListener("mousemove", function(e) {c1.move(e)}, false);
			canvasClasses.get('can').canvas.addEventListener("resize", function(e) {CanvasRedraw()}, false);
          
       
		}
        window.onscroll = function (e) { CanvasRedraw(); }  
          // window.onresize = function (e) { CanvasRedraw(); } 
           window.addEventListener('resize', CanvasRedraw);
		/* function init() {
        canvas = document.getElementById('can');
        ctx = canvas.getContext("2d");
        w = canvas.width;
        h = canvas.height;
    
        canvas.addEventListener("mousemove", function (e) {
            findxy('move', e)
        }, false);
        canvas.addEventListener("mousedown", function (e) {
            findxy('down', e)
        }, false);
        canvas.addEventListener("mouseup", function (e) {
            findxy('up', e)
        }, false);
        canvas.addEventListener("mouseout", function (e) {
            findxy('out', e)
        }, false);
    } */

		function color(obj) {
			switch (obj.id) {
				case 'green':
					x = 'green';
					break;
				case 'blue':
					x = 'blue';
					break;
				case 'red':
					x = 'red';
					break;
				case 'yellow':
					x = 'yellow';
					break;
				case 'orange':
					x = 'orange';
					break;
				case 'black':
					x = 'black';
					break;
				case 'white':
					x = 'white';
					break;
			}
			if (x == 'white') y = 14;
			else y = 2;
		}

		function erase() {
			var m = confirm('Want to clear');
			if (m) {
				ctx.clearRect(0, 0, w, h);
				document.getElementById('canvasimg').style.display = 'none';
				first = true;
			}
		}
        function CanvasRedraw()
        {
            /* canvasClasses.forEach(
               (value,key) => { value.onCanvasSizeChange}
            ) */
            for(var i; i<canvasClasses.length;i++)
            {
                i.onCanvasSizeChange();
            }
        }
		function OnNewline(canvasId) {
			var id = canvasClasses.get(canvasId);
			if (id) {
				id.newLine = true;
				id.bDrawOnMove = false;
                id.lastDraw = {x: -1, y:-1};
			}
			first = true;
		}
		function mouseDraw(canvasId) {
			var id = canvasClasses.get(canvasId);
			if (id) {
				id.newLine = false;
				id.bDrawOnMove = true;
			}
		}
		function save() {
			document.getElementById('canvasimg').style.border = '2px solid';
			var dataURL = canvas.toDataURL();
			document.getElementById('canvasimg').src = dataURL;
			document.getElementById('canvasimg').style.display = 'inline';
		}
	</script>
	<body onload="init()" onresize="CanvasRedrawb()">
		<canvas 
			id="can"
			width="40"
			height="40"
			style="position: absolute; top: 10%; left: 10%; border: 2px solid"
		></canvas>
		<div style="position: absolute; top: 12%; left: 43%">Choose Color</div>
		<div
			style="
				position: absolute;
				top: 15%;
				left: 45%;
				width: 10px;
				height: 10px;
				background: green;
			"
			id="green"
			onclick="color(this)"
		></div>
		<div
			style="
				position: absolute;
				top: 15%;
				left: 46%;
				width: 10px;
				height: 10px;
				background: blue;
			"
			id="blue"
			onclick="color(this)"
		></div>
		<div
			style="
				position: absolute;
				top: 15%;
				left: 47%;
				width: 10px;
				height: 10px;
				background: red;
			"
			id="red"
			onclick="color(this)"
		></div>
		<div
			style="
				position: absolute;
				top: 17%;
				left: 45%;
				width: 10px;
				height: 10px;
				background: yellow;
			"
			id="yellow"
			onclick="color(this)"
		></div>
		<div
			style="
				position: absolute;
				top: 17%;
				left: 46%;
				width: 10px;
				height: 10px;
				background: orange;
			"
			id="orange"
			onclick="color(this)"
		></div>
		<div
			style="
				position: absolute;
				top: 17%;
				left: 47%;
				width: 10px;
				height: 10px;
				background: black;
			"
			id="black"
			onclick="color(this)"
		></div>
		<div style="position: absolute; top: 20%; left: 43%">Eraser</div>
		<div
			style="
				position: absolute;
				top: 22%;
				left: 45%;
				width: 15px;
				height: 15px;
				background: white;
				border: 2px solid;
			"
			id="white"
			onclick="color(this)"
		></div>
		<img
			id="canvasimg"
			style="position: absolute; top: 10%; left: 52%"
			style="display: none"
		/>
		<input
			type="button"
			value="save"
			id="btn"
			size="30"
			onclick="save()"
			style="position: absolute; top: 55%; left: 10%"
		/>
		<input
			type="button"
			value="clear"
			id="clr"
			size="23"
			onclick="erase()"
			style="position: absolute; top: 55%; left: 15%"
		/>
		<input
			type="button"
			value="new lines"
			id="newLine"
			size="23"
			onclick="OnNewline('can')"
			style="position: absolute; top: 55%; left: 25%"
		/>
		<input
			type="button"
			value="mouseDraw"
			id="mouseDraw"
			size="23"
			onclick="mouseDraw('can')"
			style="position: absolute; top: 55%; left: 35%"
		/>
		<canvas
			id="can2"
			width="40"
			height="40"
			style="position: absolute; top: 70%; left: 10%; border: 2px solid"
		></canvas>
	</body>
</html>
